!function(e){function a(){}e.fn.geoPicker=function(a,t){var r={address2geo:function(e,a){GMaps.geocode({address:e,callback:a})}};switch(typeof a){case"undefined":case"object":return this.each(function(){var t,r,n,i,s;if(!e(this).data().hasOwnProperty("geopicker")){var l=function(){e(i).geoPicker("search",this.value)};if(i=e(this),c=e.extend({id:i.attr("id")+"-geopicker",insertAfter:i},e.fn.geoPicker.defaults,a||{},{searchMarker:n}),c.el=c.id,s=e(c.template.replace(/:id/g,c.id).replace(":class",c.class).replace(":style",c.style)).insertAfter(c.insertAfter),t=new GMaps(c),c.addSearch&&(t.addControl({content:c.searchTemplate.replace(":searchLabel",c.searchLabel).replace(":searchPlaceholder",c.searchPlaceholder),position:"top_right"}),e(s).on("change","input.geopicker-search",l),e(s).on("click","button.geopicker-btn",l),e(s).on("keypress","input.geopicker-search",function(e){13==e.keyCode&&(e.stopPropagation(),e.preventDefault(),l.call(this))})),t.on("click",function(e){r&&t.removeMarker(r),r=t.addMarker({title:c.pickedTitle,lat:e.latLng.lng(),lng:e.latLng.lat(),icon:c.chooseIcon}),t.setCenter(e.latLng.lng(),e.latLng.lat()),c.onPick.call(i,[e.latLng.lat(),e.latLng.lng()],e),i.val(e.latLng.lat()+","+e.latLng.lng())}),e(this).data("geopicker",c).data("gmap",t).data("map",s),e(s).data("input",i),i.val()){var o=i.val().split(",");r=t.addMarker({lat:o[0],lng:o[1],icon:c.chooseIcon}),t.setCenter(o[0],o[1]),t.fitZoom(),t.zoomOut(6)}}});case"string":switch(a){case"gmap":return e(this).first().data("gmap");case"options":return e(this).first().data("geopicker");case"map":return e(this).first().data("map");case"remove":return this.each(function(){e(this).data("map").remove(),e(this).removeData("geopicker").removeData("gmap").removeData("map")});case"search":if(inputElement=e(this).first(),e(inputElement).data().hasOwnProperty("geopicker")){var c=e(inputElement).data("geopicker"),n=e(inputElement).data("gmap");r.address2geo(t,function(a,t){if("OK"===t){var r=a[0].geometry.location;n.setCenter(r.lat(),r.lng()),c.searchMarker&&n.removeMarker(c.searchMarker),c.searchMarker=n.addMarker({lat:r.lat(),lng:r.lng(),title:e(inputElement).data("geopicker").searchTitle,icon:e(inputElement).data("geopicker").searchIcon}),e(inputElement).data("geopicker",c)}})}return this}}},e.fn.geoPicker.defaults={template:"<div id=':id' style=':style' class='geopicker-container :class'></div>",searchTemplate:"<input class='geopicker-search' placeholder=':searchPlaceholder' /><button class='geopicker-btn'>:searchLabel</button>",searchLabel:"Search",searchPlaceholder:"Search",searchTitle:"Search result",searchIcon:"http://maps.google.com/mapfiles/ms/icons/green-dot.png","class":"gllpMaps",style:"height: 200px; width: 100%; position: relative;",lat:21.4224843,lng:39.8262017,zoom:8,autoFit:!1,disableDefaultUI:!1,streetViewControl:!1,mapTypeControl:!1,onPick:a,addSearch:!0}}(jQuery);
